SRC_DIR = @top_srcdir@/src
INC_DIR = @top_srcdir@/include

WRAPPER_NAME	 = c_blike_wrapper.a
WRAPPER_PATH	 = $(SRC_DIR)/drv/wrapper

COMMON_PATH	 = $(SRC_DIR)/common
DRVGTK_PATH	 = $(SRC_DIR)/drv/drvgtk

# install
INSTALL_BIN_DIR = @prefix@@bindir@/@PACKAGE_NAME@
INSTALL_LIB_DIR = @prefix@@libdir@/@PACKAGE_NAME@
INSTALL_INCLUDE_DIR = @prefix@@includedir@/@PACKAGE_NAME@

INSTALL_CONF_DIR = /etc/ld.so.conf.d
CONF = @PACKAGE_NAME@.conf

INSTALL_PC_DIR = /usr/lib/pkgconfig
PC = @PACKAGE_NAME@.pc
PC_NAME="Name: @PACKAGE_NAME@"
PC_VERSION="Version: @PACKAGE_VERSION@"
PC_DESCRIPTION="Description: @PACKAGE_NAME@ library"
PC_REQUIRES="Requires:"
PC_LIBS="Libs: "				\
	"-L$(INSTALL_LIB_DIR) "			\
	"-lc_blike_common "			\
	"-lc_blike_drvgtk "			\
	"$(INSTALL_LIB_DIR)/$(WRAPPER_NAME) "

PC_CFLAGS="Cflags: "				\
	"-I$(INSTALL_INCLUDE_DIR) "

all:
	make -C $(WRAPPER_PATH)
	make -C $(COMMON_PATH)
	make -C $(DRVGTK_PATH)
	
clean:
	make -C $(WRAPPER_PATH)		clean
	make -C $(COMMON_PATH)		clean
	make -C $(DRVGTK_PATH)		clean



install-lib:
	mkdir -p $(INSTALL_LIB_DIR)
	cp -f $(WRAPPER_PATH)/$(WRAPPER_NAME) \
		$(INSTALL_LIB_DIR)
	cp -f $(COMMON_PATH)/lib@PACKAGE_NAME@_common.so.@PACKAGE_VERSION@ \
		$(INSTALL_LIB_DIR)
	cp -f $(DRVGTK_PATH)/lib@PACKAGE_NAME@_drvgtk.so.@PACKAGE_VERSION@ \
		$(INSTALL_LIB_DIR)

install-include:
	mkdir -p $(INSTALL_INCLUDE_DIR)
	cp -f $(INC_DIR)/blike.h  $(INSTALL_INCLUDE_DIR)
	cp -f $(INC_DIR)/blike0.h $(INSTALL_INCLUDE_DIR)

install-pc:
	make create-pc
	cp -f $(PC) $(INSTALL_PC_DIR)

install-conf:
	make create-conf
	cp -f $(CONF) $(INSTALL_CONF_DIR)
	ldconfig

install:
	make install-lib
	make install-include
	make install-pc
	make install-conf



uninstall-lib:
	rm -f $(INSTALL_LIB_DIR)/lib@PACKAGE_NAME@_common.so.@PACKAGE_VERSION@
	rm -f $(INSTALL_LIB_DIR)/lib@PACKAGE_NAME@_drvgtk.so.@PACKAGE_VERSION@

uninstall-include:
	rm -f $(INSTALL_INCLUDE_DIR)/blike.h
	rm -f $(INSTALL_INCLUDE_DIR)/blike0.h

uninstall-pc:
	rm -f $(INSTALL_PC_DIR)/$(PC)

uninstall-conf:
	rm -f $(INSTALL_CONF_DIR)/$(CONF)
	ldconfig

uninstall:
	make uninstall-lib
	make uninstall-include
	make uninstall-pc
	make uninstall-conf



create-conf:
	echo $(INSTALL_LIB_DIR) > $(CONF)

create-pc:
	echo $(PC_NAME)         > $(PC)
	echo $(PC_DESCRIPTION)  >> $(PC)
	echo $(PC_VERSION)      >> $(PC)
	echo $(PC_REQUIRES)     >> $(PC)
	echo $(PC_LIBS)         >> $(PC)
	echo $(PC_CFLAGS)       >> $(PC)

