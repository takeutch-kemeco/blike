## c_blike_01f_linux version 1.5.5

### ビルド、インストール方法

        ./autogen.sh
        ./configure --prefix=/usr
        make
        sudo make install

備考: ビルド、インストール作業には gcc, make, gnu/binutils, autoconf, automake, libtool, pkg-config が必要です。
X11環境での描画には GTK+3、非X11環境でのフレームバッファー表示には linux/fb.h による /dev/fb0 を用います。

### アンインストール方法

        sudo make uninstall

### サンプルのコンパイル方法
X11環境（GTK+3を利用）でのアプリとしてビルドする場合は以下のようにします:

        cd samples
        make clean
        make

非X11環境（フレームバッファーを利用）でのアプリとしてビルドする場合は以下のようにします:
（プリフィックスが lfb- のバイナリーが生成されます）

        cd samples
        make clean
        make -f Makefile.lfb

### たとえば自作のhello.cのコンパイル方法
X11環境（GTK+3を利用）でのアプリとしてビルドする場合:

        gcc `pkg-config blike --libs --cflags` hello.c -o hello

非X11環境（フレームバッファーを利用）でのアプリとしてビルドする場合:

        gcc -I/usr/include/blike -lblike-common -lblike-drvlfb -lm hello.c -o hello

現状、非X11環境（フレームバッファーを利用）で動作させる場合は、キーボード入力を利用できません。
まだ実装していないからです。
誰か暇な人いたら、その機能を追加するパッチを書いて提供してくれると光栄です。そんな奴がいるとはまったく期待していませんが。

### Haskell (GHC) から 利用する場合の例
samples/ghc 以下に、Haskell (GHC) から blike を利用する場合のサンプルがあります:

        cd samples/ghc
        make clean
        make

ここにある blike.hs は、FFI による blike 関数のラッパーです。
これは blike 関数を同名の Haskell 関数としてラップしてある状態です。
ビルドの書式は同梱の Makefile を参考にしてください。

hs_test000a.hs は test000a.c に相当するサンプルです。（ハローワールド）
blike は blMain が存在するため、いくらか無駄に複雑になってしまってますが、ここの書式は定形化できるので自動化して隠蔽することも可能だろうと期待してます。

blike.hs では blike.h で紹介されてる関数のほとんどをラップ済みですが、一部の関数は未実装です。
現在の blike.hs で未実装の関数は bl_printf, bl_scanf, bl_malloc, bl_getGrpB の４つです。それ以外は全て実装済みです。

blikedrv.h で紹介されてるドライバー系関数 (プリフィックスが bld_ の関数) へのラッパーは未実装です。

***
## オリジナルとは異なる c_blike_01f_linux 固有の機能

### 詳細なキーボード入力
キーボードからの入力を、より詳細に読み取れるので、ゲーム的な操作にも都合が良いです。
各キーを押した瞬間および放した瞬間を、各キー毎に独立して判断することが可能です。
これによって、キーリピートに依存せずに、純粋にキー押し・キー放しのタイミングによる操作を提供できます。
たとえば、ブロック崩しのバーの横移動などを、キーリピートに依存せずに行なえるので、スムーズな動きや操作を提供できます。

使用方法のドキュメント化は行なっていません。
ソースを直接読むか、もしくはサンプルコード sample/test_keyboard_state.c を参考にしてください。

### マウス入力のサポート
3 ボタンマウスの各ボタンの押し・放し、およびポインタ移動を利用した操作を提供できます。
これはバッファーに情報を貯める方式ではなく、コールバック関数による方式です。
押し・放し・ポインタ移動、これら３つの場合に、それぞれ対応した関数をコールバック関数として登録しておくことで、
マウス情報に応じた動作を行ないます。

使用方法のドキュメント化は行なっていません。
ソースを直接読むか、もしくはサンプルコード sample/mouse00.c を参考にしてください。

### タブレット入力のサポート
ワコムなどのタブレットによる入力をサポートします。
これはプログラム的には筆圧および傾き情報を持ったマウスとみなせます。使用方法もマウスと同じです。

使用方法のドキュメント化は行なっていません。
ソースを直接読むか、もしくはサンプルコード sample/mouse02.c を参考にしてください。

***

### 最近復活させたバグ
オリジナルの c_blike_01f との互換性を重視して、blike.h にて #define putc bl_putc を復活させてしまいました。
（本意ではありませんが、オリジナルがそうなので仕方無い）
これは本当に最低なマクロで、POSIX標準の多くの関数を bl_ 関数で置き換えてしまうので、これによって様々なデバッグ方法が期待どおりに動かせなくなります。
これは #include blike.h することで含まれてしまいます。
従って #include blike.h は非推奨です。
代わりに #include blike0.h を使うよう推奨します。これならばPOSIX標準が上書きされずに済みます。

### 最近修正したバグ
bl_gets() が正常動作せずに、メモリー違反で落ちてしまうバグを修正しました。
これは common/gets.c の方を直接修正してしまったので、公式版の c_blike_01f の動作とは異なってしまってるはずです。

### 現在判明してるバグ
bl_gets() でカーソルキーを使って入力した場合に、ウインドウ幅以上の文字列を入力する場合に、カーソルの位置が変になってしまうバグを修正しました。
しかし、これはウインドウ幅以上の文字列の編集ができない状態なので、これでは根本的には解決になっていません。

誰か暇な人いたら、修正パッチを書いて提供してくれると光栄です。そんな奴がいるとはまったく期待していませんが。
